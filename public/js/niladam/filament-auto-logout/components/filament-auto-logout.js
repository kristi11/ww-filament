window.idleTimeoutInitialized||(window.idleTimeoutInitialized=!0,document.addEventListener("alpine:init",()=>{let r=new BroadcastChannel("idleTimeoutChannel");if(!Alpine.store("idleTimeoutStore")){Alpine.store("idleTimeoutStore",{idleDurationSecs:null,warningBefore:null,timeLeftSecs:null,warningDisplayed:!1,timer:null,notificationTitle:null,notificationBody:null,units:null,resetCountdown(e=!1){this.timeLeftSecs=this.idleDurationSecs,this.warningDisplayed=!1,this.timer&&clearInterval(this.timer),e||r.postMessage({type:"resetCountdown"}),this.startCountdown()},startCountdown(){this.timer&&clearInterval(this.timer),this.timer=setInterval(()=>{this.timeLeftSecs>0?(this.timeLeftSecs--,!this.warningDisplayed&&this.timeLeftSecs<=this.warningBefore&&this.showWarning()):(clearInterval(this.timer),this.logoutUser())},1e3)},showWarning(){if(!this.warningDisplayed){let e=this.warningBefore,n=Math.floor(e/60),o=e%60,s="";n>0&&(s+=`${n} ${this.units.minutes.long}`),(o>0||n===0)&&(n>0&&(s+=" "),s+=`${o} ${this.units.seconds.long}`);let l=this.notificationBody.replace(":timeleft:",s);new FilamentNotification().title(this.notificationTitle).body(l).danger().color("danger").send(),this.warningDisplayed=!0}},logoutUser(){this.timer&&clearInterval(this.timer),document.getElementById("auto-logout-form").submit()}});let t=Alpine.store("idleTimeoutStore"),i=document.getElementById("auto-logout-form");if(i){if(!(i.dataset.autoLogoutEnabled==="1"))return;t.idleDurationSecs=parseInt(i.dataset.duration,10),t.warningBefore=parseInt(i.dataset.warnBefore,10),t.timeLeftSecs=t.idleDurationSecs,t.notificationTitle=i.dataset.notificationTitle||"Your session is about to expire",t.notificationBody=i.dataset.notificationBody||"You will be kicked out in :timeMessage",t.units=JSON.parse(i.dataset.units||"{}")}else return;t.resetCountdown();let a=["mousemove","keypress","click","touchstart","focus","change","mouseover","mouseout","mousedown","mouseup","keydown","keyup","submit","reset","select","scroll"];if(window.idleTimeoutEventListenersAttached||(a.forEach(e=>{window.addEventListener(e,()=>{r.postMessage({type:"resetCountdown"}),t.resetCountdown(!0)})}),window.idleTimeoutEventListenersAttached=!0),r.addEventListener("message",function(e){e.data?.type==="resetCountdown"?t.resetCountdown(!0):e.data?.type==="showWarning"?t.showWarning():e.data?.type==="logout"&&t.logoutUser()}),i.dataset.showTimeleft==="1"){let e=document.getElementById("idle-timeout-element");e||(e=document.createElement("div"),e.id="idle-timeout-element",document.body.appendChild(e));let n=i.dataset.timeLeftText||"";e.setAttribute("x-data",JSON.stringify({timeLeftText:n}));let o=e.querySelector("#timer-display");o||(o=document.createElement("div"),o.id="timer-display",e.appendChild(o)),o.setAttribute("x-text",'timeLeftText + " " + ((Math.floor($store.idleTimeoutStore.timeLeftSecs / 60) > 0) ? ( Math.floor($store.idleTimeoutStore.timeLeftSecs / 60) + $store.idleTimeoutStore.units.minutes.short + " " + ($store.idleTimeoutStore.timeLeftSecs % 60) + $store.idleTimeoutStore.units.seconds.short ) : ( ($store.idleTimeoutStore.timeLeftSecs % 60) + $store.idleTimeoutStore.units.seconds.short ))'),Alpine.initTree(e)}}}));
